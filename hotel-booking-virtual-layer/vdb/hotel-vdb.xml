<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<vdb name="hotel" version="1">

  <description>Hotel VDB</description>
  	<model name="Monolith">
		<property name="importer.useFullSchemaName" value="false"/>
		<property name="importer.TableTypes" value="TABLE" />
		<property name="importer.importKeys" value="false"/>
		<property name="importer.schemapattern" value="public"/>
        <source name="monolithdb" translator-name="postgresql" connection-jndi-name="java:/monolithdb"/>
    </model>
	<model name="DataServiceLayer" type="VIRTUAL" visible="true">
		<metadata type="DDL"><![CDATA[

		CREATE VIEW hotel(
			id integer NOT NULL,
			name string(256) NOT NULL,
			stars decimal NOT NULL,
			price integer NOT NULL,
			city_name string(256) NOT NULL,
			country_name string(256) NOT NULL,
			address string(256) NOT NULL,
			available_rooms integer NOT NULL,
			CONSTRAINT hotel_pk PRIMARY KEY(id)
		) 
		AS
			SELECT 
				h.id,
				h.name,
				h.stars,
				h.price,
				h.city_name,
				h.country_name,
				h.address,
				COUNT(r.id) as available_rooms
			FROM 
				Monolith.hotel h LEFT OUTER JOIN Monolith.room r 
					ON h.id = r.hotel_id
			GROUP BY 
				h.id, h.name, h.stars, h.price, h.city_name, h.country_name, h.address;
		]]></metadata>
	</model>
</vdb>